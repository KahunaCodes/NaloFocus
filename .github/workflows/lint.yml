name: Lint

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    name: Swift Linting
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Swift
      uses: swift-actions/setup-swift@v1
      with:
        swift-version: "6.0"

    - name: Install SwiftLint
      run: |
        brew install swiftlint || true
      continue-on-error: true

    - name: Run Custom Linting
      run: |
        chmod +x scripts/swift-lint.sh
        ./scripts/swift-lint.sh

    - name: Run SwiftLint (if available)
      run: |
        if command -v swiftlint &> /dev/null; then
          swiftlint --config .swiftlint.yml --reporter github-actions-logging || true
        else
          echo "SwiftLint not available, skipping..."
        fi
      continue-on-error: true

    - name: Build with Warnings
      run: swift build 2>&1 | tee build.log

    - name: Check for Warnings
      run: |
        if grep -E "warning:" build.log; then
          echo "::warning::Build produced warnings. Please review."
        fi